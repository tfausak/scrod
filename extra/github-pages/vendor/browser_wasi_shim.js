/* esm.sh - github:haskell-wasm/browser_wasi_shim#2f86b49dce50916e2984029c535321e34b234229 */
var Ue=Object.defineProperty;var Fe=(f,e)=>{for(var t in e)Ue(f,t,{get:e[t],enumerable:!0})};var W={};Fe(W,{ADVICE_DONTNEED:()=>Un,ADVICE_NOREUSE:()=>Fn,ADVICE_NORMAL:()=>xn,ADVICE_RANDOM:()=>Ln,ADVICE_SEQUENTIAL:()=>Dn,ADVICE_WILLNEED:()=>Cn,CLOCKID_MONOTONIC:()=>Q,CLOCKID_PROCESS_CPUTIME_ID:()=>ke,CLOCKID_REALTIME:()=>X,CLOCKID_THREAD_CPUTIME_ID:()=>Me,Ciovec:()=>Y,Dirent:()=>P,ERRNO_2BIG:()=>He,ERRNO_ACCES:()=>Ye,ERRNO_ADDRINUSE:()=>Ve,ERRNO_ADDRNOTAVAIL:()=>We,ERRNO_AFNOSUPPORT:()=>ve,ERRNO_AGAIN:()=>je,ERRNO_ALREADY:()=>Ke,ERRNO_BADF:()=>c,ERRNO_BADMSG:()=>ze,ERRNO_BUSY:()=>Xe,ERRNO_CANCELED:()=>Qe,ERRNO_CHILD:()=>Ze,ERRNO_CONNABORTED:()=>qe,ERRNO_CONNREFUSED:()=>Je,ERRNO_CONNRESET:()=>$e,ERRNO_DEADLK:()=>et,ERRNO_DESTADDRREQ:()=>tt,ERRNO_DOM:()=>nt,ERRNO_DQUOT:()=>rt,ERRNO_EXIST:()=>V,ERRNO_FAULT:()=>it,ERRNO_FBIG:()=>st,ERRNO_HOSTUNREACH:()=>ot,ERRNO_IDRM:()=>at,ERRNO_ILSEQ:()=>ut,ERRNO_INPROGRESS:()=>_t,ERRNO_INTR:()=>ft,ERRNO_INVAL:()=>S,ERRNO_IO:()=>lt,ERRNO_ISCONN:()=>dt,ERRNO_ISDIR:()=>ie,ERRNO_LOOP:()=>ct,ERRNO_MFILE:()=>bt,ERRNO_MLINK:()=>Rt,ERRNO_MSGSIZE:()=>mt,ERRNO_MULTIHOP:()=>Et,ERRNO_NAMETOOLONG:()=>Re,ERRNO_NETDOWN:()=>pt,ERRNO_NETRESET:()=>gt,ERRNO_NETUNREACH:()=>Nt,ERRNO_NFILE:()=>wt,ERRNO_NOBUFS:()=>ht,ERRNO_NODEV:()=>Ot,ERRNO_NOENT:()=>A,ERRNO_NOEXEC:()=>St,ERRNO_NOLCK:()=>Tt,ERRNO_NOLINK:()=>yt,ERRNO_NOMEM:()=>At,ERRNO_NOMSG:()=>It,ERRNO_NOPROTOOPT:()=>xt,ERRNO_NOSPC:()=>Dt,ERRNO_NOSYS:()=>me,ERRNO_NOTCAPABLE:()=>oe,ERRNO_NOTCONN:()=>Lt,ERRNO_NOTDIR:()=>y,ERRNO_NOTEMPTY:()=>se,ERRNO_NOTRECOVERABLE:()=>Ct,ERRNO_NOTSOCK:()=>Ut,ERRNO_NOTSUP:()=>p,ERRNO_NOTTY:()=>Ft,ERRNO_NXIO:()=>Pt,ERRNO_OVERFLOW:()=>Bt,ERRNO_OWNERDEAD:()=>Gt,ERRNO_PERM:()=>C,ERRNO_PIPE:()=>kt,ERRNO_PROTO:()=>Mt,ERRNO_PROTONOSUPPORT:()=>Ht,ERRNO_PROTOTYPE:()=>Yt,ERRNO_RANGE:()=>Vt,ERRNO_ROFS:()=>Wt,ERRNO_SPIPE:()=>vt,ERRNO_SRCH:()=>jt,ERRNO_STALE:()=>Kt,ERRNO_SUCCESS:()=>R,ERRNO_TIMEDOUT:()=>zt,ERRNO_TXTBSY:()=>Xt,ERRNO_XDEV:()=>Qt,EVENTRWFLAGS_FD_READWRITE_HANGUP:()=>Yn,EVENTTYPE_CLOCK:()=>he,EVENTTYPE_FD_READ:()=>Mn,EVENTTYPE_FD_WRITE:()=>Hn,Event:()=>K,FDFLAGS_APPEND:()=>J,FDFLAGS_DSYNC:()=>Pn,FDFLAGS_NONBLOCK:()=>Bn,FDFLAGS_RSYNC:()=>Gn,FDFLAGS_SYNC:()=>kn,FD_STDERR:()=>Ge,FD_STDIN:()=>Pe,FD_STDOUT:()=>Be,FILETYPE_BLOCK_DEVICE:()=>yn,FILETYPE_CHARACTER_DEVICE:()=>ae,FILETYPE_DIRECTORY:()=>h,FILETYPE_REGULAR_FILE:()=>I,FILETYPE_SOCKET_DGRAM:()=>An,FILETYPE_SOCKET_STREAM:()=>In,FILETYPE_SYMBOLIC_LINK:()=>Ee,FILETYPE_UNKNOWN:()=>Tn,FSTFLAGS_ATIM:()=>pe,FSTFLAGS_ATIM_NOW:()=>ge,FSTFLAGS_MTIM:()=>Ne,FSTFLAGS_MTIM_NOW:()=>we,Fdstat:()=>D,Filestat:()=>T,Iovec:()=>H,OFLAGS_CREAT:()=>$,OFLAGS_DIRECTORY:()=>G,OFLAGS_EXCL:()=>ue,OFLAGS_TRUNC:()=>k,PREOPENTYPE_DIR:()=>xe,Prestat:()=>z,PrestatDir:()=>re,RIFLAGS_RECV_PEEK:()=>gr,RIFLAGS_RECV_WAITALL:()=>Nr,RIGHTS_FD_ADVISE:()=>nn,RIGHTS_FD_ALLOCATE:()=>rn,RIGHTS_FD_DATASYNC:()=>Zt,RIGHTS_FD_FDSTAT_SET_FLAGS:()=>$t,RIGHTS_FD_FILESTAT_GET:()=>En,RIGHTS_FD_FILESTAT_SET_SIZE:()=>pn,RIGHTS_FD_FILESTAT_SET_TIMES:()=>gn,RIGHTS_FD_READ:()=>qt,RIGHTS_FD_READDIR:()=>fn,RIGHTS_FD_SEEK:()=>Jt,RIGHTS_FD_SYNC:()=>en,RIGHTS_FD_TELL:()=>tn,RIGHTS_FD_WRITE:()=>U,RIGHTS_PATH_CREATE_DIRECTORY:()=>sn,RIGHTS_PATH_CREATE_FILE:()=>on,RIGHTS_PATH_FILESTAT_GET:()=>bn,RIGHTS_PATH_FILESTAT_SET_SIZE:()=>Rn,RIGHTS_PATH_FILESTAT_SET_TIMES:()=>mn,RIGHTS_PATH_LINK_SOURCE:()=>an,RIGHTS_PATH_LINK_TARGET:()=>un,RIGHTS_PATH_OPEN:()=>_n,RIGHTS_PATH_READLINK:()=>ln,RIGHTS_PATH_REMOVE_DIRECTORY:()=>wn,RIGHTS_PATH_RENAME_SOURCE:()=>dn,RIGHTS_PATH_RENAME_TARGET:()=>cn,RIGHTS_PATH_SYMLINK:()=>Nn,RIGHTS_PATH_UNLINK_FILE:()=>hn,RIGHTS_POLL_FD_READWRITE:()=>On,RIGHTS_SOCK_SHUTDOWN:()=>Sn,ROFLAGS_RECV_DATA_TRUNCATED:()=>wr,SDFLAGS_RD:()=>hr,SDFLAGS_WR:()=>Or,SIGNAL_ABRT:()=>Xn,SIGNAL_ALRM:()=>nr,SIGNAL_BUS:()=>Qn,SIGNAL_CHLD:()=>ir,SIGNAL_CONT:()=>sr,SIGNAL_FPE:()=>Zn,SIGNAL_HUP:()=>Wn,SIGNAL_ILL:()=>Kn,SIGNAL_INT:()=>vn,SIGNAL_KILL:()=>qn,SIGNAL_NONE:()=>Vn,SIGNAL_PIPE:()=>tr,SIGNAL_POLL:()=>mr,SIGNAL_PROF:()=>br,SIGNAL_PWR:()=>Er,SIGNAL_QUIT:()=>jn,SIGNAL_SEGV:()=>$n,SIGNAL_STOP:()=>or,SIGNAL_SYS:()=>pr,SIGNAL_TERM:()=>rr,SIGNAL_TRAP:()=>zn,SIGNAL_TSTP:()=>ar,SIGNAL_TTIN:()=>ur,SIGNAL_TTOU:()=>_r,SIGNAL_URG:()=>fr,SIGNAL_USR1:()=>Jn,SIGNAL_USR2:()=>er,SIGNAL_VTALRM:()=>cr,SIGNAL_WINCH:()=>Rr,SIGNAL_XCPU:()=>lr,SIGNAL_XFSZ:()=>dr,SUBCLOCKFLAGS_SUBSCRIPTION_CLOCK_ABSTIME:()=>Oe,Subscription:()=>j,WHENCE_CUR:()=>q,WHENCE_END:()=>B,WHENCE_SET:()=>Z});var Pe=0,Be=1,Ge=2,X=0,Q=1,ke=2,Me=3,R=0,He=1,Ye=2,Ve=3,We=4,ve=5,je=6,Ke=7,c=8,ze=9,Xe=10,Qe=11,Ze=12,qe=13,Je=14,$e=15,et=16,tt=17,nt=18,rt=19,V=20,it=21,st=22,ot=23,at=24,ut=25,_t=26,ft=27,S=28,lt=29,dt=30,ie=31,ct=32,bt=33,Rt=34,mt=35,Et=36,Re=37,pt=38,gt=39,Nt=40,wt=41,ht=42,Ot=43,A=44,St=45,Tt=46,yt=47,At=48,It=49,xt=50,Dt=51,me=52,Lt=53,y=54,se=55,Ct=56,Ut=57,p=58,Ft=59,Pt=60,Bt=61,Gt=62,C=63,kt=64,Mt=65,Ht=66,Yt=67,Vt=68,Wt=69,vt=70,jt=71,Kt=72,zt=73,Xt=74,Qt=75,oe=76,Zt=1,qt=2,Jt=4,$t=8,en=16,tn=32,U=64,nn=128,rn=256,sn=512,on=1024,an=2048,un=4096,_n=8192,fn=16384,ln=32768,dn=65536,cn=131072,bn=262144,Rn=524288,mn=1048576,En=2097152,pn=4194304,gn=8388608,Nn=16777216,wn=33554432,hn=67108864,On=134217728,Sn=268435456,H=class f{buf;buf_len;static read_bytes(e,t){let s=new f;return s.buf=e.getUint32(t,!0),s.buf_len=e.getUint32(t+4,!0),s}static read_bytes_array(e,t,s){let _=[];for(let n=0;n<s;n++)_.push(f.read_bytes(e,t+8*n));return _}},Y=class f{buf;buf_len;static read_bytes(e,t){let s=new f;return s.buf=e.getUint32(t,!0),s.buf_len=e.getUint32(t+4,!0),s}static read_bytes_array(e,t,s){let _=[];for(let n=0;n<s;n++)_.push(f.read_bytes(e,t+8*n));return _}},Z=0,q=1,B=2,Tn=0,yn=1,ae=2,h=3,I=4,An=5,In=6,Ee=7,P=class{d_next;d_ino;d_namlen;d_type;dir_name;constructor(e,t,s,_){let n=new TextEncoder().encode(s);this.d_next=e,this.d_ino=t,this.d_namlen=n.byteLength,this.d_type=_,this.dir_name=n}head_length(){return 24}name_length(){return this.dir_name.byteLength}write_head_bytes(e,t){e.setBigUint64(t,this.d_next,!0),e.setBigUint64(t+8,this.d_ino,!0),e.setUint32(t+16,this.dir_name.length,!0),e.setUint8(t+20,this.d_type)}write_name_bytes(e,t,s){e.set(this.dir_name.slice(0,Math.min(this.dir_name.byteLength,s)),t)}},xn=0,Dn=1,Ln=2,Cn=3,Un=4,Fn=5,J=1,Pn=2,Bn=4,Gn=8,kn=16,D=class{fs_filetype;fs_flags;fs_rights_base=0n;fs_rights_inherited=0n;constructor(e,t){this.fs_filetype=e,this.fs_flags=t}write_bytes(e,t){e.setUint8(t,this.fs_filetype),e.setUint16(t+2,this.fs_flags,!0),e.setBigUint64(t+8,this.fs_rights_base,!0),e.setBigUint64(t+16,this.fs_rights_inherited,!0)}},pe=1,ge=2,Ne=4,we=8,$=1,G=2,ue=4,k=8,T=class{dev=0n;ino;filetype;nlink=0n;size;atim;mtim;ctim;constructor(e,t,s,_=0n,n=0n,r=0n){this.ino=e,this.filetype=t,this.size=s,this.atim=_,this.mtim=n,this.ctim=r}write_bytes(e,t){e.setBigUint64(t,this.dev,!0),e.setBigUint64(t+8,this.ino,!0),e.setUint8(t+16,this.filetype),e.setBigUint64(t+24,this.nlink,!0),e.setBigUint64(t+32,this.size,!0),e.setBigUint64(t+40,this.atim,!0),e.setBigUint64(t+48,this.mtim,!0),e.setBigUint64(t+56,this.ctim,!0)}},he=0,Mn=1,Hn=2,Yn=1,Oe=1,j=class f{constructor(e,t,s,_,n){this.userdata=e;this.eventtype=t;this.clockid=s;this.timeout=_;this.flags=n}static read_bytes(e,t){return new f(e.getBigUint64(t,!0),e.getUint8(t+8),e.getUint32(t+16,!0),e.getBigUint64(t+24,!0),e.getUint16(t+36,!0))}},K=class{constructor(e,t,s){this.userdata=e;this.error=t;this.eventtype=s}write_bytes(e,t){e.setBigUint64(t,this.userdata,!0),e.setUint16(t+8,this.error,!0),e.setUint8(t+10,this.eventtype)}},Vn=0,Wn=1,vn=2,jn=3,Kn=4,zn=5,Xn=6,Qn=7,Zn=8,qn=9,Jn=10,$n=11,er=12,tr=13,nr=14,rr=15,ir=16,sr=17,or=18,ar=19,ur=20,_r=21,fr=22,lr=23,dr=24,cr=25,br=26,Rr=27,mr=28,Er=29,pr=30,gr=1,Nr=2,wr=1,hr=1,Or=2,xe=0,re=class{pr_name;constructor(e){this.pr_name=new TextEncoder().encode(e)}write_bytes(e,t){e.setUint32(t,this.pr_name.byteLength,!0)}},z=class f{tag;inner;static dir(e){let t=new f;return t.tag=xe,t.inner=new re(e),t}write_bytes(e,t){e.setUint32(t,this.tag,!0),this.inner.write_bytes(e,t+4)}};var Se=class{constructor(e){this.isEnabled=e;this.enable(e)}prefix="wasi:";log;enable(e){this.log=Sr(e===void 0?!0:e,this.prefix)}get enabled(){return this.isEnabled}};function Sr(f,e){return f?console.log.bind(console,"%c%s","color: #265BA0",e):()=>{}}var w=new Se(!1);var L=class{fd_allocate(e,t){return 58}fd_close(){return 0}fd_fdstat_get(){return{ret:58,fdstat:null}}fd_fdstat_set_flags(e){return 58}fd_fdstat_set_rights(e,t){return 58}fd_filestat_get(){return{ret:58,filestat:null}}fd_filestat_set_size(e){return 58}fd_filestat_set_times(e,t,s){return 58}fd_pread(e,t){return{ret:58,data:new Uint8Array}}fd_prestat_get(){return{ret:58,prestat:null}}fd_pwrite(e,t){return{ret:58,nwritten:0}}fd_read(e){return{ret:58,data:new Uint8Array}}fd_readdir_single(e){return{ret:58,dirent:null}}fd_seek(e,t){return{ret:58,offset:0n}}fd_sync(){return 0}fd_tell(){return{ret:58,offset:0n}}fd_write(e){return{ret:58,nwritten:0}}path_create_directory(e){return 58}path_filestat_get(e,t){return{ret:58,filestat:null}}path_filestat_set_times(e,t,s,_,n){return 58}path_link(e,t,s){return 58}path_unlink(e){return{ret:58,inode_obj:null}}path_lookup(e,t){return{ret:58,inode_obj:null}}path_open(e,t,s,_,n,r){return{ret:54,fd_obj:null}}path_readlink(e){return{ret:58,data:null}}path_symlink(e,t){return 58}path_remove_directory(e){return 58}path_rename(e,t,s){return 58}path_unlink_file(e){return 58}},x=class f{ino;constructor(){this.ino=f.issue_ino()}static next_ino=1n;static issue_ino(){return f.next_ino++}static root_ino(){return 0n}};function _e(f,e){if(f.byteLength===e)return f;if(f.buffer instanceof ArrayBuffer&&f.buffer.resizable&&e<=f.buffer.maxByteLength)return f.buffer.resize(e),f;if(f.byteLength>e){let _=new ArrayBuffer(e,{maxByteLength:e}),n=new Uint8Array(_);return n.set(new Uint8Array(f.buffer,0,e)),n}let t=new ArrayBuffer(e,{maxByteLength:Math.max(e,f.buffer.maxByteLength*2)}),s=new Uint8Array(t);return s.set(f),s}var fe=class extends L{file;file_pos=0n;constructor(e){super(),this.file=e}fd_allocate(e,t){return this.file.size>=e+t||(this.file.data=_e(this.file.data,Number(e+t))),0}fd_close(){return this.file.data.buffer instanceof ArrayBuffer&&this.file.data.buffer.resizable&&(this.file.data=new Uint8Array(this.file.data)),0}fd_fdstat_get(){return{ret:0,fdstat:new D(I,0)}}fd_filestat_set_size(e){return this.file.data=_e(this.file.data,Number(e)),0}fd_filestat_set_times(e,t,s){return this.file.set_times(e,t,s)}fd_read(e){let t=this.file.data.slice(Number(this.file_pos),Number(this.file_pos+BigInt(e)));return this.file_pos+=BigInt(t.length),{ret:0,data:t}}fd_pread(e,t){return{ret:0,data:this.file.data.slice(Number(t),Number(t+BigInt(e)))}}fd_seek(e,t){let s;switch(t){case Z:s=e;break;case q:s=this.file_pos+e;break;case B:s=BigInt(this.file.data.byteLength)+e;break;default:return{ret:28,offset:0n}}return s<0?{ret:28,offset:0n}:(this.file_pos=s,{ret:0,offset:this.file_pos})}fd_tell(){return{ret:0,offset:this.file_pos}}fd_write(e){return this.file.readonly?{ret:8,nwritten:0}:(this.file_pos+BigInt(e.byteLength)>this.file.size&&(this.file.data=_e(this.file.data,Number(this.file_pos+BigInt(e.byteLength)))),this.file.data.set(e,Number(this.file_pos)),this.file_pos+=BigInt(e.byteLength),{ret:0,nwritten:e.byteLength})}fd_pwrite(e,t){return this.file.readonly?{ret:8,nwritten:0}:(t+BigInt(e.byteLength)>this.file.size&&(this.file.data=_e(this.file.data,Number(t+BigInt(e.byteLength)))),this.file.data.set(e,Number(t)),{ret:0,nwritten:e.byteLength})}fd_filestat_get(){return{ret:0,filestat:this.file.stat()}}},ee=class extends L{dir;constructor(e){super(),this.dir=e}fd_seek(e,t){return{ret:8,offset:0n}}fd_tell(){return{ret:8,offset:0n}}fd_allocate(e,t){return 8}fd_fdstat_get(){return{ret:0,fdstat:new D(h,0)}}fd_readdir_single(e){if(w.enabled&&(w.log("readdir_single",e),w.log(e,this.dir.contents.keys())),e==0n)return{ret:0,dirent:new P(1n,this.dir.ino,".",h)};if(e==1n)return{ret:0,dirent:new P(2n,this.dir.parent_ino(),"..",h)};if(e>=BigInt(this.dir.contents.size)+2n)return{ret:0,dirent:null};let[t,s]=Array.from(this.dir.contents.entries())[Number(e-2n)];return{ret:0,dirent:new P(e+1n,s.ino,t,s.stat().filetype)}}path_filestat_get(e,t){let{ret:s,path:_}=O.from(t);if(_==null)return{ret:s,filestat:null};let{ret:n,entry:r}=this.dir.get_entry_for_path(_);return r==null?{ret:n,filestat:null}:{ret:0,filestat:r.stat()}}path_filestat_set_times(e,t,s,_,n){let{ret:r,path:i}=O.from(t);if(i==null)return r;let{ret:o,entry:a}=this.dir.get_entry_for_path(i);return a==null?o:a.set_times(s,_,n)}path_lookup(e,t){let{ret:s,path:_}=O.from(e);if(_==null)return{ret:s,inode_obj:null};let{ret:n,entry:r}=this.dir.get_entry_for_path(_);return r==null?{ret:n,inode_obj:null}:{ret:0,inode_obj:r}}path_open(e,t,s,_,n,r){let{ret:i,path:o}=O.from(t);if(o==null)return{ret:i,fd_obj:null};let{ret:a,entry:u}=this.dir.get_entry_for_path(o);if(u==null){if(a!=44)return{ret:a,fd_obj:null};if((s&$)==$){let{ret:l,entry:d}=this.dir.create_entry_for_path(t,(s&G)==G);if(d==null)return{ret:l,fd_obj:null};u=d}else return{ret:44,fd_obj:null}}else if((s&ue)==ue)return{ret:20,fd_obj:null};return(s&G)==G&&u.stat().filetype!==h?{ret:54,fd_obj:null}:u.path_open(s,_,r)}path_create_directory(e){return this.path_open(0,e,$|G,0n,0n,0).ret}path_link(e,t,s){let{ret:_,path:n}=O.from(e);if(n==null)return _;if(n.is_dir)return 44;let{ret:r,parent_entry:i,filename:o,entry:a}=this.dir.get_parent_dir_and_entry_for_path(n,!0);if(i==null||o==null)return r;if(a!=null){let u=t.stat().filetype==h,l=a.stat().filetype==h;if(u&&l)if(s&&a instanceof F){if(a.contents.size!=0)return 55}else return 20;else{if(u&&!l)return 54;if(!u&&l)return 31;if(!(t.stat().filetype==I&&a.stat().filetype==I))return 20}}return!s&&t.stat().filetype==h?63:(t instanceof F&&(t.parent=i),i.contents.set(o,t),i.resolvePendingLinkTarget(o,t),0)}path_symlink(e,t){let{ret:s,path:_}=O.from(t);if(_==null)return s;let{ret:n,parent_entry:r,filename:i}=this.dir.get_parent_dir_and_entry_for_path(_,!0);if(r==null||i==null)return n;let{ret:o,path:a}=O.from(e);if(a==null)return o;let{ret:u,parent_entry:l,filename:d,entry:b}=r.get_parent_dir_and_entry_for_path(a,!0);if(l==null||d==null)return u;if(b!=null)return this.path_link(t,b,!0);let E=new de(r,i,l,d),m=this.path_link(t,E,!0);return m!=0?m:(l.registerPendingLinkTarget(d,E),0)}path_unlink(e){let{ret:t,path:s}=O.from(e);if(s==null)return{ret:t,inode_obj:null};let{ret:_,parent_entry:n,filename:r,entry:i}=this.dir.get_parent_dir_and_entry_for_path(s,!0);return n==null||r==null?{ret:_,inode_obj:null}:i==null?{ret:44,inode_obj:null}:(Le(i),n.contents.delete(r),{ret:0,inode_obj:i})}path_unlink_file(e){let{ret:t,path:s}=O.from(e);if(s==null)return t;let{ret:_,parent_entry:n,filename:r,entry:i}=this.dir.get_parent_dir_and_entry_for_path(s,!1);return n==null||r==null||i==null?_:i.stat().filetype===h?31:(Le(i),n.contents.delete(r),0)}path_remove_directory(e){let{ret:t,path:s}=O.from(e);if(s==null)return t;let{ret:_,parent_entry:n,filename:r,entry:i}=this.dir.get_parent_dir_and_entry_for_path(s,!1);return n==null||r==null||i==null?_:!(i instanceof F)||i.stat().filetype!==h?54:i.contents.size!==0?55:n.contents.delete(r)?0:44}fd_filestat_get(){return{ret:0,filestat:this.dir.stat()}}fd_filestat_set_size(e){return 8}fd_filestat_set_times(e,t,s){return this.dir.set_times(e,t,s)}fd_read(e){return{ret:8,data:new Uint8Array}}fd_pread(e,t){return{ret:8,data:new Uint8Array}}fd_write(e){return{ret:8,nwritten:0}}fd_pwrite(e,t){return{ret:8,nwritten:0}}},te=class extends ee{prestat_name;constructor(e,t){super(new F(t)),this.prestat_name=e}fd_prestat_get(){return{ret:0,prestat:z.dir(this.prestat_name)}}};function De(){return BigInt(Date.now())*1000000n}var v=class extends x{atim;mtim;ctim;constructor(){super();let e=De();this.atim=e,this.mtim=e,this.ctim=e}set_times(e,t,s){let _=De();return s&pe&&(this.atim=e,this.ctim=_),s&ge&&(this.atim=_,this.ctim=_),s&Ne&&(this.mtim=t,this.ctim=_),s&we&&(this.mtim=_,this.ctim=_),0}},le=class extends v{data;readonly;constructor(e,t){super(),this.data=new Uint8Array(e),this.readonly=!!t?.readonly}path_open(e,t,s){if(this.readonly&&(t&BigInt(64))==BigInt(64))return{ret:63,fd_obj:null};if((e&k)==k){if(this.readonly)return{ret:63,fd_obj:null};this.data=new Uint8Array([])}let _=new fe(this);return s&J&&_.fd_seek(0n,B),{ret:0,fd_obj:_}}get size(){return BigInt(this.data.byteLength)}stat(){return new T(this.ino,I,this.size,this.atim,this.mtim,this.ctim)}},O=class f{parts=[];is_dir=!1;static from(e){let t=new f;if(t.is_dir=e.endsWith("/"),e.startsWith("/"))return{ret:76,path:null};if(e.includes("\0"))return{ret:28,path:null};for(let s of e.split("/"))if(!(s===""||s===".")){if(s===".."){if(t.parts.pop()==null)return{ret:76,path:null};continue}t.parts.push(s)}return{ret:0,path:t}}to_path_string(){let e=this.parts.join("/");return this.is_dir&&(e+="/"),e}},F=class f extends v{contents;parent=null;pendingSymlinkTargets;constructor(e){super(),e instanceof Array?this.contents=new Map(e):this.contents=e;for(let t of this.contents.values())t instanceof f&&(t.parent=this)}parent_ino(){return this.parent==null?x.root_ino():this.parent.ino}path_open(e,t,s){return{ret:0,fd_obj:new ee(this)}}stat(){return new T(this.ino,h,0n,this.atim,this.mtim,this.ctim)}get_entry_for_path(e){let t=this;for(let s of e.parts){if(!(t instanceof f))return{ret:54,entry:null};let _=t.contents.get(s);if(_!==void 0)t=_;else return w.log(s),{ret:44,entry:null}}return e.is_dir&&t.stat().filetype!=h?{ret:54,entry:null}:{ret:0,entry:t}}get_parent_dir_and_entry_for_path(e,t){let s=e.parts.pop();if(s===void 0)return{ret:28,parent_entry:null,filename:null,entry:null};let{ret:_,entry:n}=this.get_entry_for_path(e);if(n==null)return{ret:_,parent_entry:null,filename:null,entry:null};if(!(n instanceof f))return{ret:54,parent_entry:null,filename:null,entry:null};let r=n.contents.get(s);return r===void 0?t?{ret:0,parent_entry:n,filename:s,entry:null}:{ret:44,parent_entry:null,filename:null,entry:null}:e.is_dir&&r.stat().filetype!=h?{ret:54,parent_entry:null,filename:null,entry:null}:{ret:0,parent_entry:n,filename:s,entry:r}}create_entry_for_path(e,t){let{ret:s,path:_}=O.from(e);if(_==null)return{ret:s,entry:null};let{ret:n,parent_entry:r,filename:i,entry:o}=this.get_parent_dir_and_entry_for_path(_,!0);if(r==null||i==null)return{ret:n,entry:null};if(o!=null)return{ret:20,entry:null};w.log("create",_);let a;return t?(a=new f(new Map),a.parent=r):a=new le(new ArrayBuffer(0)),r.contents.set(i,a),o=a,r.resolvePendingLinkTarget(i,o),{ret:0,entry:o}}registerPendingLinkTarget(e,t){this.pendingSymlinkTargets==null&&(this.pendingSymlinkTargets=new Map);let s=this.pendingSymlinkTargets.get(e);s==null?this.pendingSymlinkTargets.set(e,[t]):s.push(t)}removePendingLinkTarget(e,t){let s=this.pendingSymlinkTargets?.get(e);if(s==null)return;let _=s.indexOf(t);_!=-1&&s.splice(_,1),s.length==0&&this.pendingSymlinkTargets?.delete(e)}resolvePendingLinkTarget(e,t){let s=this.pendingSymlinkTargets?.get(e);if(s!=null){this.pendingSymlinkTargets?.delete(e);for(let _ of s)_.resolve(t)}}},de=class extends v{parent;filename;targetDir;targetName;constructor(e,t,s,_){super(),this.parent=e,this.filename=t,this.targetDir=s,this.targetName=_}resolve(e){if(this.parent.contents.get(this.filename)!==this){this.detach();return}e instanceof F&&(e.parent=this.parent),this.parent.contents.set(this.filename,e),this.detach()}path_open(e,t,s){return{ret:44,fd_obj:null}}stat(){return new T(this.ino,Ee,0n,this.atim,this.mtim,this.ctim)}detach(){this.targetDir!=null&&this.targetName!=null&&(this.targetDir.removePendingLinkTarget(this.targetName,this),this.targetDir=null,this.targetName=null)}};function Le(f){f instanceof de&&f.detach()}var Te=class f extends L{ino;write;constructor(e){super(),this.ino=x.issue_ino(),this.write=e}fd_filestat_get(){return{ret:0,filestat:new T(this.ino,ae,BigInt(0))}}fd_fdstat_get(){let e=new D(ae,0);return e.fs_rights_base=BigInt(64),{ret:0,fdstat:e}}fd_write(e){return this.write(e),{ret:0,nwritten:e.byteLength}}static lineBuffered(e){let t=new TextDecoder("utf-8",{fatal:!1}),s="";return new f(_=>{s+=t.decode(_,{stream:!0});let n=s.split(`
`);for(let[r,i]of n.entries())r<n.length-1?e(i):s=i})}};var ne=class extends Error{constructor(t){super("exit with exit code "+t);this.code=t}},ce=class{#e=[];args=[];env=[];fds=[];inst;wasiImport;start(e){this.inst=e;try{return e.exports._start(),0}catch(t){if(t instanceof ne)return t.code;throw t}finally{this.#e=[];for(let t=3;t<this.fds.length;++t)if(!(this.fds[t]instanceof te)){this.fds.splice(t,this.fds.length-t);break}}}initialize(e){this.inst=e,e.exports._initialize&&e.exports._initialize()}constructor(e,t,s,_={}){w.enable(_.debug),this.args=e,this.env=t,this.fds=s;let n=this;this.wasiImport={args_sizes_get(r,i){let o=new DataView(n.inst.exports.memory.buffer);o.setUint32(r,n.args.length,!0);let a=0;for(let u of n.args)a+=u.length+1;return o.setUint32(i,a,!0),w.log(o.getUint32(r,!0),o.getUint32(i,!0)),0},args_get(r,i){let o=new DataView(n.inst.exports.memory.buffer),a=new Uint8Array(n.inst.exports.memory.buffer),u=i;for(let l=0;l<n.args.length;l++){o.setUint32(r,i,!0),r+=4;let d=new TextEncoder().encode(n.args[l]);a.set(d,i),o.setUint8(i+d.length,0),i+=d.length+1}return w.enabled&&w.log(new TextDecoder("utf-8").decode(a.slice(u,i))),0},environ_sizes_get(r,i){let o=new DataView(n.inst.exports.memory.buffer);o.setUint32(r,n.env.length,!0);let a=0;for(let u of n.env)a+=new TextEncoder().encode(u).length+1;return o.setUint32(i,a,!0),w.log(o.getUint32(r,!0),o.getUint32(i,!0)),0},environ_get(r,i){let o=new DataView(n.inst.exports.memory.buffer),a=new Uint8Array(n.inst.exports.memory.buffer),u=i;for(let l=0;l<n.env.length;l++){o.setUint32(r,i,!0),r+=4;let d=new TextEncoder().encode(n.env[l]);a.set(d,i),o.setUint8(i+d.length,0),i+=d.length+1}return w.enabled&&w.log(new TextDecoder("utf-8").decode(a.slice(u,i))),0},clock_res_get(r,i){let o;switch(r){case 1:{o=5000n;break}case 0:{o=1000000n;break}default:return 52}return new DataView(n.inst.exports.memory.buffer).setBigUint64(i,o,!0),0},clock_time_get(r,i,o){let a=new DataView(n.inst.exports.memory.buffer);if(r===0)a.setBigUint64(o,BigInt(new Date().getTime())*1000000n,!0);else if(r==1){let u;try{u=BigInt(Math.round(performance.now()*1e6))}catch{u=0n}a.setBigUint64(o,u,!0)}else a.setBigUint64(o,0n,!0);return 0},fd_advise(r,i,o,a){return n.fds[r]!=null?0:8},fd_allocate(r,i,o){return n.fds[r]!=null?n.fds[r].fd_allocate(i,o):8},fd_close(r){if(n.fds[r]!=null){let i=n.fds[r].fd_close();return n.fds[r]=void 0,n.#e.push(r),i}else return 8},fd_datasync(r){return n.fds[r]!=null?n.fds[r].fd_sync():8},fd_fdstat_get(r,i){if(n.fds[r]!=null){let{ret:o,fdstat:a}=n.fds[r].fd_fdstat_get();return a?.write_bytes(new DataView(n.inst.exports.memory.buffer),i),o}else return 8},fd_fdstat_set_flags(r,i){return n.fds[r]!=null?n.fds[r].fd_fdstat_set_flags(i):8},fd_fdstat_set_rights(r,i,o){return n.fds[r]!=null?n.fds[r].fd_fdstat_set_rights(i,o):8},fd_filestat_get(r,i){if(n.fds[r]!=null){let{ret:o,filestat:a}=n.fds[r].fd_filestat_get();return a?.write_bytes(new DataView(n.inst.exports.memory.buffer),i),o}else return 8},fd_filestat_set_size(r,i){return n.fds[r]!=null?n.fds[r].fd_filestat_set_size(i):8},fd_filestat_set_times(r,i,o,a){return n.fds[r]!=null?n.fds[r].fd_filestat_set_times(i,o,a):8},fd_pread(r,i,o,a,u){let l=new DataView(n.inst.exports.memory.buffer),d=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let b=H.read_bytes_array(l,i,o),E=0;for(let m of b){let{ret:g,data:N}=n.fds[r].fd_pread(m.buf_len,a);if(g!=0)return l.setUint32(u,E,!0),g;if(d.set(N,m.buf),E+=N.length,a+=BigInt(N.length),N.length!=m.buf_len)break}return l.setUint32(u,E,!0),0}else return 8},fd_prestat_get(r,i){let o=new DataView(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let{ret:a,prestat:u}=n.fds[r].fd_prestat_get();return u?.write_bytes(o,i),a}else return 8},fd_prestat_dir_name(r,i,o){if(n.fds[r]!=null){let{ret:a,prestat:u}=n.fds[r].fd_prestat_get();if(u==null)return a;let l=u.inner.pr_name;return new Uint8Array(n.inst.exports.memory.buffer).set(l.slice(0,o),i),l.byteLength>o?37:0}else return 8},fd_pwrite(r,i,o,a,u){let l=new DataView(n.inst.exports.memory.buffer),d=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let b=Y.read_bytes_array(l,i,o),E=0;for(let m of b){let g=d.slice(m.buf,m.buf+m.buf_len),{ret:N,nwritten:M}=n.fds[r].fd_pwrite(g,a);if(N!=0)return l.setUint32(u,E,!0),N;if(E+=M,a+=BigInt(M),M!=g.byteLength)break}return l.setUint32(u,E,!0),0}else return 8},fd_read(r,i,o,a){let u=new DataView(n.inst.exports.memory.buffer),l=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let d=H.read_bytes_array(u,i,o),b=0;for(let E of d){let{ret:m,data:g}=n.fds[r].fd_read(E.buf_len);if(m!=0)return u.setUint32(a,b,!0),m;if(l.set(g,E.buf),b+=g.length,g.length!=E.buf_len)break}return u.setUint32(a,b,!0),0}else return 8},fd_readdir(r,i,o,a,u){let l=new DataView(n.inst.exports.memory.buffer),d=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let b=0;for(;;){let{ret:E,dirent:m}=n.fds[r].fd_readdir_single(a);if(E!=0)return l.setUint32(u,b,!0),E;if(m==null)break;if(o-b<m.head_length()){b=o;break}let g=new ArrayBuffer(m.head_length());if(m.write_head_bytes(new DataView(g),0),d.set(new Uint8Array(g).slice(0,Math.min(g.byteLength,o-b)),i),i+=m.head_length(),b+=m.head_length(),o-b<m.name_length()){b=o;break}m.write_name_bytes(d,i,o-b),i+=m.name_length(),b+=m.name_length(),a=m.d_next}return l.setUint32(u,b,!0),0}else return 8},fd_renumber(r,i){if(n.fds[r]!=null&&n.fds[i]!=null){let o=n.fds[i].fd_close();return o!=0?o:(n.fds[i]=n.fds[r],n.fds[r]=void 0,n.#e.push(r),0)}else return 8},fd_seek(r,i,o,a){let u=new DataView(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let{ret:l,offset:d}=n.fds[r].fd_seek(i,o);return u.setBigInt64(a,d,!0),l}else return 8},fd_sync(r){return n.fds[r]!=null?n.fds[r].fd_sync():8},fd_tell(r,i){let o=new DataView(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let{ret:a,offset:u}=n.fds[r].fd_tell();return o.setBigUint64(i,u,!0),a}else return 8},fd_write(r,i,o,a){let u=new DataView(n.inst.exports.memory.buffer),l=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let d=Y.read_bytes_array(u,i,o),b=0;for(let E of d){let m=l.slice(E.buf,E.buf+E.buf_len),{ret:g,nwritten:N}=n.fds[r].fd_write(m);if(g!=0)return u.setUint32(a,b,!0),g;if(b+=N,N!=m.byteLength)break}return u.setUint32(a,b,!0),0}else return 8},path_create_directory(r,i,o){let a=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let u=new TextDecoder("utf-8").decode(a.slice(i,i+o));return n.fds[r].path_create_directory(u)}else return 8},path_filestat_get(r,i,o,a,u){let l=new DataView(n.inst.exports.memory.buffer),d=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let b=new TextDecoder("utf-8").decode(d.slice(o,o+a)),{ret:E,filestat:m}=n.fds[r].path_filestat_get(i,b);return m?.write_bytes(l,u),E}else return 8},path_filestat_set_times(r,i,o,a,u,l,d){let b=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let E=new TextDecoder("utf-8").decode(b.slice(o,o+a));return n.fds[r].path_filestat_set_times(i,E,u,l,d)}else return 8},path_link(r,i,o,a,u,l,d){let b=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null&&n.fds[u]!=null){let E=new TextDecoder("utf-8").decode(b.slice(o,o+a)),m=new TextDecoder("utf-8").decode(b.slice(l,l+d)),{ret:g,inode_obj:N}=n.fds[r].path_lookup(E,i);return N==null?g:n.fds[u].path_link(m,N,!1)}else return 8},path_open(r,i,o,a,u,l,d,b,E){let m=new DataView(n.inst.exports.memory.buffer),g=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let N=new TextDecoder("utf-8").decode(g.slice(o,o+a));w.log(N);let{ret:M,fd_obj:Ae}=n.fds[r].path_open(i,N,u,l,d,b);if(M!=0)return M;let Ce=(()=>{if(n.#e.length>0){let Ie=n.#e.pop();return n.fds[Ie]=Ae,Ie}return n.fds.push(Ae),n.fds.length-1})();return m.setUint32(E,Ce,!0),0}else return 8},path_readlink(r,i,o,a,u,l){let d=new DataView(n.inst.exports.memory.buffer),b=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let E=new TextDecoder("utf-8").decode(b.slice(i,i+o));w.log(E);let{ret:m,data:g}=n.fds[r].path_readlink(E);if(g!=null){let N=new TextEncoder().encode(g);if(N.length>u)return d.setUint32(l,0,!0),8;b.set(N,a),d.setUint32(l,N.length,!0)}return m}else return 8},path_remove_directory(r,i,o){let a=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let u=new TextDecoder("utf-8").decode(a.slice(i,i+o));return n.fds[r].path_remove_directory(u)}else return 8},path_rename(r,i,o,a,u,l){let d=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null&&n.fds[a]!=null){let b=new TextDecoder("utf-8").decode(d.slice(i,i+o)),E=new TextDecoder("utf-8").decode(d.slice(u,u+l)),{ret:m,inode_obj:g}=n.fds[r].path_unlink(b);if(g==null)return m;if(m=n.fds[a].path_link(E,g,!0),m!=0&&n.fds[r].path_link(b,g,!0)!=0)throw"path_link should always return success when relinking an inode back to the original place";return m}else return 8},path_symlink(r,i,o,a,u){let l=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[o]!=null){let d=new TextDecoder("utf-8").decode(l.slice(r,r+i)),b=new TextDecoder("utf-8").decode(l.slice(a,a+u));return n.fds[o].path_symlink(d,b)}else return 8},path_unlink_file(r,i,o){let a=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let u=new TextDecoder("utf-8").decode(a.slice(i,i+o));return n.fds[r].path_unlink_file(u)}else return 8},poll_oneoff(r,i,o){if(o===0)return 28;if(o>1)return w.log("poll_oneoff: only a single subscription is supported"),58;let a=new DataView(n.inst.exports.memory.buffer),u=j.read_bytes(a,r),l=u.eventtype,d=u.clockid,b=u.timeout;if(l!==he)return w.log("poll_oneoff: only clock subscriptions are supported"),58;let E;if(d===1)E=()=>BigInt(Math.round(performance.now()*1e6));else if(d===0)E=()=>BigInt(new Date().getTime())*1000000n;else return 28;let m=(u.flags&Oe)!==0?b:E()+b;for(;m>E(););return new K(u.userdata,0,l).write_bytes(a,i),0},proc_exit(r){throw new ne(r)},proc_raise(r){throw"raised signal "+r},sched_yield(){},random_get(r,i){let o=new Uint8Array(n.inst.exports.memory.buffer).subarray(r,r+i);try{for(let a=0;a<i;a+=65536)crypto.getRandomValues(o.subarray(a,a+65536))}catch{let a=new Uint8Array(i);for(let u=0;u<i+65536;u+=65536)crypto.getRandomValues(a.subarray(u,u+65536));o.set(a,0)}},sock_recv(r,i,o){throw"sockets not supported"},sock_send(r,i,o){throw"sockets not supported"},sock_shutdown(r,i){throw"sockets not supported"},sock_accept(r,i){throw"sockets not supported"}}}};var ye=class extends x{handle;readonly;constructor(e,t){super(),this.handle=e,this.readonly=!!t?.readonly}path_open(e,t,s){if(this.readonly&&(t&BigInt(64))==BigInt(64))return{ret:63,fd_obj:null};if((e&k)==k){if(this.readonly)return{ret:63,fd_obj:null};this.handle.truncate(0)}let _=new be(this);return s&J&&_.fd_seek(0n,B),{ret:0,fd_obj:_}}get size(){return BigInt(this.handle.getSize())}stat(){return new T(this.ino,I,this.size)}},be=class extends L{file;position=0n;ino;constructor(e){super(),this.file=e,this.ino=x.issue_ino()}fd_allocate(e,t){return BigInt(this.file.handle.getSize())>e+t||this.file.handle.truncate(Number(e+t)),0}fd_fdstat_get(){return{ret:0,fdstat:new D(I,0)}}fd_filestat_get(){return{ret:0,filestat:new T(this.ino,I,BigInt(this.file.handle.getSize()))}}fd_filestat_set_size(e){return this.file.handle.truncate(Number(e)),0}fd_read(e){let t=new Uint8Array(e),s=this.file.handle.read(t,{at:Number(this.position)});return this.position+=BigInt(s),{ret:0,data:t.slice(0,s)}}fd_seek(e,t){let s;switch(t){case Z:s=BigInt(e);break;case q:s=this.position+BigInt(e);break;case B:s=BigInt(this.file.handle.getSize())+BigInt(e);break;default:return{ret:28,offset:0n}}return s<0?{ret:28,offset:0n}:(this.position=s,{ret:0,offset:this.position})}fd_write(e){if(this.file.readonly)return{ret:8,nwritten:0};let t=this.file.handle.write(e,{at:Number(this.position)});return this.position+=BigInt(t),{ret:0,nwritten:t}}fd_sync(){return this.file.handle.flush(),0}};function Tr(f,e){return new Proxy(f,{get(t,s,_){let n=Reflect.get(t,s,_);return e.includes(s)||typeof n!="function"?n:(...r)=>{console.log(s,"(",...r,")");let i=Reflect.apply(n,_,r);return console.log(" =",i),i}}})}export{Te as ConsoleStdout,F as Directory,L as Fd,le as File,x as Inode,v as InodeMem,ee as OpenDirectory,fe as OpenFile,be as OpenSyncOPFSFile,te as PreopenDirectory,ye as SyncOPFSFile,ce as WASI,ne as WASIProcExit,Tr as strace,W as wasi};
//# sourceMappingURL=browser_wasi_shim.mjs.map
